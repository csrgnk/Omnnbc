<script>
    const path = window.location.pathname;
    const cleanId = path.split('/').filter(Boolean).pop();
    const repo = "/Omnnbc"; 

    function copyURL() { 
        navigator.clipboard.writeText(window.location.href); 
        alert("Link copied!"); 
    }

    if (cleanId && cleanId !== 'Omnnbc') {
        // 1. Check Pages JSON first
        fetch(`${repo}/data/pages.json`)
            .then(res => res.json())
            .then(pages => {
                const page = pages.find(p => p.id === cleanId);
                if (page) {
                    loadContent(`${repo}/${page.file}`, page.title, false);
                } else {
                    // 2. Check Posts JSON second
                    return fetch(`${repo}/data/posts.json`);
                }
            })
            .then(res => res ? res.json() : null)
            .then(posts => {
                if (!posts) return;
                const post = posts.find(p => p.url.includes(cleanId));
                if (post) {
                    loadContent(`${repo}/posts/${cleanId}.html`, post.title, true);
                } else {
                    document.getElementById('postTitle').innerText = "404 - Not Found";
                    document.getElementById('postContent').innerHTML = "<p>The requested page could not be found.</p>";
                }
            })
            .catch(err => {
                console.error("Routing error:", err);
            });
    }

    function loadContent(url, title, isPost) {
        document.getElementById('postTitle').innerText = title;
        document.title = title + " - Namo Narayanaya";
        
        fetch(url)
            .then(res => res.text())
            .then(html => {
                // This cleans the incoming HTML to prevent double headers if they exist
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                
                // Remove any existing headers or footers found inside the loaded file
                const badTags = tempDiv.querySelectorAll('header, footer, nav');
                badTags.forEach(tag => tag.remove());

                document.getElementById('postContent').innerHTML = tempDiv.innerHTML;

                if (isPost) {
                    const shareUrl = encodeURIComponent(window.location.href);
                    const msg = encodeURIComponent(title + "\n\n");
                    document.getElementById('sWA').href = `https://api.whatsapp.com/send?text=${msg}${shareUrl}`;
                    document.getElementById('sFB').href = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
                    document.getElementById('sTW').href = `https://twitter.com/intent/tweet?text=${msg}&url=${shareUrl}`;
                    document.getElementById('shareRow').style.display = 'flex';
                } else {
                    // Hide share buttons for static pages like Privacy or About Us
                    document.getElementById('shareRow').style.display = 'none';
                }
            });
    }
</script>
