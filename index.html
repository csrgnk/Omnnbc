<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namo Narayanaya Bhakthi Channel</title>
    <style>
        body { margin:0; font-family: 'Segoe UI', Arial, sans-serif; background:#f4f6f9; display: flex; flex-direction: column; min-height: 100vh; }
        header { background:#fff9db; padding:20px; text-align:center; font-size:1.8rem; font-weight:bold; color:#C2185B; border-bottom: 3px solid #FFD700; }
        
        /* Search Box */
        .search-container { max-width: 800px; margin: 20px auto; padding: 0 20px; text-align: center; }
        #postSearch { width: 100%; padding: 12px 20px; font-size: 16px; border: 2px solid #C2185B; border-radius: 25px; outline: none; box-sizing: border-box; }
        
        .container { max-width:800px; margin:auto; padding:20px; flex: 1; }
        
        /* Post Card Styling */
        .post-card { background:#FFFDE7; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.08); border-left: 5px solid #C2185B; transition: transform 0.2s; }
        .post-card:hover { transform: translateY(-3px); }
        .post-card h2 { margin:0 0 10px; color:#002366; }
        .post-card a { text-decoration:none; color:#002366; }
        .date { color:#777; font-size:13px; margin-bottom:15px; display: block; }
        
        /* Read More Button */
        .read-btn { display:inline-block; padding:8px 18px; background:#FF9800; color:#fff; border-radius:20px; text-decoration:none; font-size:14px; font-weight:bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        footer { background: #C2185B; color: white; text-align: center; padding: 20px; margin-top: 40px; }
    </style>
</head>
<body>

<header>Namo Narayanaya Bhakthi Channel</header>

<div class="search-container">
    <input type="text" id="postSearch" placeholder="Search for stotrams (e.g. Rama, Surya)...">
</div>

<div class="container" id="postsContainer">Loading divine content...</div>

<footer>
    <p>Â© 2026 Namo Narayanaya Bhakthi Channel</p>
    <p>Spreading Peace and Devotion</p>
</footer>

<script>
    let allPosts = [];

    // Fetch the post database
    fetch('./data/posts.json')
    .then(res => res.json())
    .then(posts => {
        // Sort by date (Newest first)
        allPosts = posts.sort((a, b) => new Date(b.publish_date) - new Date(a.publish_date));
        displayPosts(allPosts);
    })
    .catch(() => { 
        document.getElementById("postsContainer").innerHTML = "Error loading posts. Please check data/posts.json"; 
    });

    function displayPosts(postsToDisplay) {
        const container = document.getElementById("postsContainer");
        container.innerHTML = "";

        if (postsToDisplay.length === 0) {
            container.innerHTML = "<p style='text-align:center;'>No stotrams found matching your search.</p>";
            return;
        }

        postsToDisplay.forEach(post => {
            // URL CLEANING: Removes 'posts/' and '.html'
            // Result: "rama-stotram" instead of "posts/rama-stotram.html"
            const cleanId = post.url.replace('posts/', '').replace('.html', '');
            
            const card = document.createElement("div");
            card.className = "post-card";
            card.innerHTML = `
                <h2><a href="${cleanId}">${post.title}</a></h2>
                <span class="date">ðŸ“… Published on: ${post.publish_date}</span>
                <a href="${cleanId}" class="read-btn">Read More</a>
            `;
            container.appendChild(card);
        });
    }

    // Live Search Logic
    document.getElementById('postSearch').addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filtered = allPosts.filter(post => 
            post.title.toLowerCase().includes(searchTerm)
        );
        displayPosts(filtered);
    });
</script>

</body>
</html>
